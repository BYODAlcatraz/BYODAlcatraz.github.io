- name: Create a file with specific content in the Documents directory
  hosts: localhost
  vars:
    enddate_time: "2024-05-22T09:11:00.000Z"

  tasks:
    - name: Get current UTC time
      uri:
        url: "http://worldtimeapi.org/api/timezone/etc/utc"
        method: GET
        return_content: yes
      register: time_response

    - name: Parse current UTC time
      set_fact:
        current_utc_time: "{{ (time_response.content | from_json).utc_datetime }}"

    - name: Convert enddate_time to timestamp
      set_fact:
        enddate_time_ts: "{{ enddate_time | to_datetime('%Y-%m-%dT%H:%M:%S.%f%z') }}"

    - name: Convert current_utc_time to timestamp
      set_fact:
        current_utc_time_ts: "{{ current_utc_time | to_datetime('%Y-%m-%dT%H:%M:%S.%f%z') }}"

    - name: End playbook if current time is after the end time
      meta: end_play
      when: current_utc_time_ts > enddate_time_ts

    - name: Enable firefox
      file: 
        dest: /usr/bin/firefox
        mode: a+x
